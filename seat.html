<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seat Booking | Kashish Travels</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:#f5f6f8;color:#222;}
.header{background:#fff;padding:14px;text-align:center;font-size:20px;font-weight:600;box-shadow:0 4px 15px rgba(0,0,0,.08);}
.bus-card{max-width:950px;margin:25px auto;background:#fff;border-radius:18px;box-shadow:0 25px 60px rgba(0,0,0,.12);overflow:hidden;}
.deck-switch{display:flex;background:#f1f1f1;}
.deck-btn{flex:1;padding:16px;text-align:center;font-weight:600;cursor:pointer;}
.deck-btn.active{background:#fff;border-bottom:4px solid #ffc107;}
.interior{padding:25px;display:none;}
.interior.active{display:block;}
.driver{text-align:right;font-size:14px;color:#777;margin-bottom:10px;}
.layout{display:grid;grid-template-columns:95px 45px 95px 95px;gap:20px;justify-content:center;}
.seat{height:95px;border-radius:14px;background:linear-gradient(145deg,#fdfdfd,#e6e6e6);box-shadow:inset 0 0 0 2px #d0d0d0,0 6px 14px rgba(0,0,0,.15);cursor:pointer;position:relative;}
.seat.booked{background:#e57373;cursor:not-allowed;}
.seat::before{content:'';position:absolute;top:8px;left:10px;right:10px;height:18px;background:#cfcfcf;border-radius:8px;}
.seat span{position:absolute;bottom:8px;right:10px;font-size:12px;font-weight:600;color:#555;}
.seat.selected{background:linear-gradient(145deg,#a5d6a7,#66bb6a);box-shadow:inset 0 0 0 2px #2e7d32,0 6px 14px rgba(0,0,0,.2);}
.seat.selected::before{background:#2e7d32;}
.seat.selected span{color:#fff;}
.book-bar{padding:22px;border-top:1px solid #ddd;display:flex;justify-content:space-between;align-items:center;}
.book-btn{padding:12px 20px;font-size:16px;font-weight:700;background:linear-gradient(135deg,#ffd54f,#ffc107);border:none;border-radius:12px;cursor:pointer;}
.book-btn:hover{background:#e0b600;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;}
.modal-box{background:#fff;width:90%;max-width:430px;padding:26px;border-radius:16px;box-shadow:0 30px 60px rgba(0,0,0,.25);}
.modal-box h3{text-align:center;margin-top:0;}
.modal-box input{width:100%;padding:14px;margin:12px 0;border-radius:10px;border:1px solid #ccc;font-size:15px;}
.confirm-btn{width:100%;padding:15px;background:linear-gradient(135deg,#ffd54f,#ffc107);border:none;font-weight:700;border-radius:10px;cursor:pointer;}
.success{display:none;text-align:center;}
.success h2{color:#2e7d32;}
.download{margin-top:15px;padding:14px;width:100%;background:#4caf50;border:none;color:#fff;border-radius:10px;font-size:16px;cursor:pointer;}
.total-fare{font-weight:600;color:#222;}
.avail-count{font-weight:600;color:#222;}
</style>
</head>
<body>

<div class="header" id="headerBus">Kashish AC Sleeper - ‚Çπ750 per seat</div>

<div class="bus-card">
<div class="deck-switch">
  <div class="deck-btn active" onclick="switchDeck('lower',this)">LOWER</div>
  <div class="deck-btn" onclick="switchDeck('upper',this)">UPPER</div>
</div>

<div id="lower" class="interior active">
  <div class="driver">üßë‚Äç‚úàÔ∏è Driver</div>
  <div class="layout" id="lowerLayout"></div>
</div>

<div id="upper" class="interior">
  <div class="layout" id="upperLayout"></div>
</div>

<div class="book-bar">
  <div class="avail-count" id="availableSeats">Available Seats: 36</div>
  <button class="book-btn" onclick="openForm()">Book Selected Seats</button>
  <div class="total-fare" id="fare">Total Fare: ‚Çπ0</div>
</div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-box">
<div id="form">
<h3>Passenger Details</h3>
<input id="pname" placeholder="Full Name">
<input id="pmobile" placeholder="Mobile Number" maxlength="10">
<button class="confirm-btn" onclick="confirmBooking()">Confirm Booking</button>
</div>

<div class="success" id="success">
<h2>Booking Successful üéâ</h2>
<p>Your seats are confirmed</p>
<button class="download" onclick="downloadPDF()">Download Receipt</button>
</div>
</div>
</div>

<script>
const selected=[];
const busName="Kashish AC Sleeper";
const price=750;
let date=new Date().toISOString().split("T")[0]; // default today

// Load booked seats from localStorage per date
function getBookedSeats(date){
    return JSON.parse(localStorage.getItem(busName+"-"+date)) || [];
}

// Update Available Seats count
function updateAvailable(){
    let booked=getBookedSeats(date);
    let avail=36 - booked.length;
    document.getElementById("availableSeats").innerText="Available Seats: "+avail;
}

function generate(layout,start,deck){
  let bookedSeats = getBookedSeats(date);
  layout.innerHTML="";
  for(let i=0;i<18;i++){
    let seat=document.createElement("div");
    let seatNo=start+i;
    let label=`${deck}-${seatNo}`;
    seat.className="seat";
    seat.innerHTML=`<span>${label}</span>`;

    if(bookedSeats.includes(label)){
      seat.classList.add("booked");
    }else{
      seat.onclick=()=>{
        seat.classList.toggle("selected");
        if(seat.classList.contains("selected")){
          selected.push(label);
        }else{
          let idx=selected.indexOf(label);
          if(idx>-1) selected.splice(idx,1);
        }
        updateFare();
      }
    }

    layout.appendChild(seat);
    if((i+1)%3==1) layout.appendChild(document.createElement("div"));
  }
  updateAvailable();
}

function updateFare(){
  document.getElementById("fare").innerText="Total Fare: ‚Çπ"+(selected.length*price);
}

// Initial Layout
generate(document.getElementById("lowerLayout"),1,"Lower");
generate(document.getElementById("upperLayout"),19,"Upper");

function switchDeck(id,btn){
  document.querySelectorAll(".interior").forEach(d=>d.classList.remove("active"));
  document.querySelectorAll(".deck-btn").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  btn.classList.add("active");
}

function openForm(){
  if(selected.length==0){alert("Please select seats");return;}
  document.getElementById("modal").style.display="flex";
}

let receiptData={};
function confirmBooking(){
  let n=document.getElementById("pname").value.trim();
  let m=document.getElementById("pmobile").value.trim();
  if(!n||m.length!=10){alert("Enter valid details");return;}

  // Save selected seats as booked for this date
  let prev=getBookedSeats(date);
  let newBooked=prev.concat(selected);
  localStorage.setItem(busName+"-"+date,JSON.stringify(newBooked));

  receiptData={
    name:n,
    mobile:m,
    seats:selected.join(", "),
    id:"KT"+Date.now(),
    date:new Date().toLocaleString(),
    busName:busName,
    totalFare:selected.length*price
  };

  document.getElementById("form").style.display="none";
  document.getElementById("success").style.display="block";

  // Update layout & availability
  generate(document.getElementById("lowerLayout"),1,"Lower");
  generate(document.getElementById("upperLayout"),19,"Upper");
}

function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("KASHISH TRAVELS",20,20);
  pdf.text("Booking ID: "+receiptData.id,20,30);
  pdf.text("Name: "+receiptData.name,20,40);
  pdf.text("Mobile: "+receiptData.mobile,20,50);
  pdf.text("Bus: "+receiptData.busName,20,60);
  pdf.text("Seats: "+receiptData.seats,20,70);
  pdf.text("Total Fare: ‚Çπ"+receiptData.totalFare,20,80);
  pdf.text("Booked On: "+receiptData.date,20,90);
  pdf.save("Kashish_Ticket.pdf");
}
</script>
</body>
</html>
