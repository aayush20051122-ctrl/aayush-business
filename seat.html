<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seat Booking | Kashish Travels</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:'Segoe UI';background:#f5f6f8;}
.header{
  background:#fff;padding:14px;text-align:center;
  font-size:18px;font-weight:600;
}
.layout{
  max-width:900px;margin:20px auto;
  display:grid;grid-template-columns:repeat(6,1fr);gap:12px;
}
.seat{
  background:#eee;padding:18px;text-align:center;
  border-radius:8px;cursor:pointer;font-weight:600;
}
.seat.booked{background:#e57373;color:#fff;cursor:not-allowed;}
.seat.selected{background:#66bb6a;color:#fff;}
.book-btn{
  display:block;margin:20px auto;padding:14px 30px;
  font-weight:700;background:#ffc107;border:none;border-radius:10px;
}
</style>
</head>

<body>

<div class="header" id="header"></div>
<div class="layout" id="seats"></div>
<button class="book-btn" onclick="bookSeats()">Confirm Booking</button>

<script>
const TOTAL_SEATS = 36;

const busName = localStorage.getItem("busName");
const route   = localStorage.getItem("route");
const price   = localStorage.getItem("price");
const rawDate = localStorage.getItem("busDate");

if(!rawDate){
  alert("Invalid access. Search again.");
  window.location.href="search.html";
}

function formatDate(d){
  return new Date(d).toLocaleDateString("en-GB",
  {day:"2-digit",month:"short",year:"numeric"});
}

document.getElementById("header").innerText =
`${busName} | ${route} | â‚¹${price} | ${formatDate(rawDate)}`;

function bookingKey(){
  return busName + "__" + route + "__" + rawDate;
}

let booked = JSON.parse(localStorage.getItem(bookingKey())) || [];
let selected = [];
const seatsDiv = document.getElementById("seats");

for(let i=1;i<=TOTAL_SEATS;i++){
  const seat=document.createElement("div");
  seat.innerText=i;
  seat.className="seat";

  if(booked.includes(i)){
    seat.classList.add("booked");
  }

  seat.onclick=()=>{
    if(seat.classList.contains("booked")) return;
    seat.classList.toggle("selected");
    if(selected.includes(i))
      selected=selected.filter(x=>x!==i);
    else
      selected.push(i);
  };
  seatsDiv.appendChild(seat);
}

function bookSeats(){
  if(selected.length===0){
    alert("Seat select karo");
    return;
  }
  booked = booked.concat(selected);
  localStorage.setItem(bookingKey(), JSON.stringify(booked));
  alert("Booking Successful!");
  window.location.href="search.html"; // ðŸ”¥ back to search
}
</script>

</body>
</html>
